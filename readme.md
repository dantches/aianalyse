# VulnOpt — базовый классификатор уязвимостей

Этот репозиторий демонстрирует минимальный пайплайн обнаружения уязвимых фрагментов кода. 
Модель — простая нейросеть, которая обучается распознавать опасные шаблоны в небольшом
датасете C-функций. Пайплайн включает обучение, переоценку качества и инференс через Typer-CLI.

## Что делает модель
- **Назначение.** Определяет, содержит ли фрагмент C-кода типичные ошибки безопасности
  (переполнение буфера, форматные строки, SQL/command injection и т. д.).
- **Вход.** Сырые тексты функций. Перед подачей в сеть код токенизируется и превращается
  в TF‑IDF-вектор с униграммами и биграммами (макс. 4096 признаков).
- **Архитектура.** Полносвязная сеть `4096 → 256 → 128 → 2` с ReLU и дропаутом 0.2.
- **Обучение.** Оптимизатор Adam + CrossEntropyLoss. Пайплайн использует 
  заранее разбитые выборки `train/valid` и сохраняет историю метрик по эпохам.
- **Оценка.** `vulnopt.cli evaluate-cmd` пересобирает признаки через сохранённый TF‑IDF,
  загружает веса и пересчитывает loss/accuracy на обучающей и валидационной части.
- **Инференс.** `vulnopt.cli infer-cmd` принимает JSON с полем `code`, восстанавливает
  TF‑IDF-векторизацию и возвращает вероятности классов `safe`/`vulnerable`.

## Датасет
- **Источник.** `data/synthetic_vuln/*.jsonl` — компактная выборка, собранная из типовых
  шаблонов Juliet Test Suite (CWE-121, CWE-134, CWE-78 и др.) и их безопасных вариантов.
  Каждый файл содержит JSONL со строками вида `{ "code": ..., "label": 0|1 }`.
- **Размер.** 84 обучающих, 18 валидационных и 18 тестовых функций.
- **Формат.** `label=1` — уязвимый фрагмент, `label=0` — безопасный вариант.

## Качество
На стандартных гиперпараметрах (`epochs=15`, `batch_size=32`, `lr=1e-3`) модель стабильно
достигает **85–90%** точности на валидации. Точная цифра зависит от случайной инициализации.

## Повторение экспериментов
```bash
# Обучение
PYTHONPATH=src python -m vulnopt.cli train-cmd --epochs 15 --out runs/vuln_example

# Переоценка точности (используется тот же датасет, что и при обучении)
PYTHONPATH=src python -m vulnopt.cli evaluate-cmd runs/vuln_example/vuln_classifier.pt

# Инференс: анализ нескольких функций из файла samples.json
PYTHONPATH=src python -m vulnopt.cli infer-cmd runs/vuln_example/vuln_classifier.pt samples.json predictions.json
```
Результатом обучения будут файлы `vuln_classifier.pt` (чекпойнт) и `metrics.json` (метрики по эпохам).
